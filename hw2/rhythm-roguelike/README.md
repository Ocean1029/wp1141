# Rhythm Dungeon

一個結合節拍遊戲和 Roguelike 元素的網頁遊戲，使用 React + TypeScript + Vite 開發。

這個遊戲的 idea 是來自於 [Crypt of the NecroDancer](https://store.steampowered.com/app/247080/Crypt_of_the_NecroDancer/?l=tchinese&curator_clanid=29519836)，利用音樂的節奏來控制敵人、角色的戰鬥與移動。很可惜的是，這個遊戲太大了，我投入時間下去才發現根本做不完，目前實作出了遊戲的節拍、音樂的切換、視覺化的節拍器等功能。

完整的 spec 長下面這樣：

1. Rhythm System
- 節奏會隨著音樂改變，每首個有他的速度。
- 音效系統中，在正負拍應該要有不同的基礎音效（向節拍器那樣），並且負拍的聲音會比較小
- 在畫面中有節奏的 bar
- 判定：與一個節奏遊戲一樣，只有在拍點的前後一個很短的時間按下按鍵時，這個輸入才算是 valid。
- 音樂來源可以先在網路上找固定音軌

2. Player System
- 基礎移動只有上下左右 arrow，不支援斜向，但之後會構思 shift 衝刺等技能，在 v1.0 只要把基礎移動做出來就好
- 在 v1.0 ，玩家會有血量 / 攻擊力兩種屬性，對於戰士而言，基礎預設為 10 滴，傷害 3
- 對於一個戰士，玩家可以在反拍按下 F 攻擊在自己上下左右的其中一個敵人，並且用上下左右 arrow 指定攻擊方向，如果上下左右的敵人只有一個，則沒有指定方向或沒有按到正確的方向也會自動攻擊到該敵人
- 未來要可以支援多個職業，也就是在反拍時按下 F 會有不同的攻擊方式，在 v1.0 只需要有戰士

3. Enemy Design
- 在 v1.0 要設計四種敵人，他們分別是 ：
近戰 A：
血量： 9
攻擊力：2
不相鄰：正拍向玩家靠近一格。
相鄰：若下個正拍時玩家仍在原格 → 攻擊。
若玩家閃走 → 本次攻擊冷卻，不行動。

近戰 B：
血量： 7
攻擊力：3
不相鄰：正拍向玩家靠近一格。
相鄰：若下個正拍時玩家仍在原格 → 攻擊。
若玩家閃走 → 正常移動追擊玩家。

遠程 A：
血量： 5
攻擊力： 3
正拍的模式是三輪循環，兩次移動一次射箭，移動會傾向往遠離角色的同 row 或同 column 方向前進，射箭會面向角色。箭會朝同個方向每隔一個半拍移動一格，碰到角色的格子及損血，撞到牆壁及消失。

史萊姆 A：
血量 5 
攻擊力 2
每兩個正拍會隨機移動一格，在地上留下黏液，當玩家碰到時，下個正拍不能移動

- 製作敵人前，請先定義「向玩家靠近一格」的移動方式
- 在角色位置的判斷中，先是處理角色的判斷，再進行攻擊和移動判斷。例如玩家原本在下個正拍要被箭射中，但他在該正拍移動到其他格子（與箭不同的三個方向），則可以成功閃避那隻箭。
- 在 v1.0 不用有 boss

4. Map Design
- 每個房間會切成很多個格子，玩家和敵人各佔了一個格子，他們都會依照節奏執行不同的行為
- 房間的形狀與大小依照關卡而定，不一定會是一個矩形，但 v1.0 可以先做 8*8 / 6*6 / 4*6 的矩形就好
- 一層地牢會有多個房間，而這個遊戲會擴展到很多層，玩家完成一層與一個房間時都會有獎勵
- 對於 v1.0，請先設計三層，第一層會是 intro，只需要有一個怪物房，與一個有向下樓梯，並且可以開獎勵的房間
- 遊戲希望有 roughlike 屬性：房間數量，房間樣子，各個房間的怪物的種類與數量應該都是具有隨機性的，並且越到下面的關卡應該越難

5. Reward Machenism
每個房間的 reward 目前都設定為生成一個愛心，玩家碰到可以回 3 滴血。
每層的 reward 先設定為生命上限 + 5 / 傷害 + 1 / 回滿血 3 選 1

6. Art Design
- 2.5D 像素風

7. Progression & Meta
- 因為這次作業沒有要寫資料庫，所以每次 run 沒有任何資源保留，可以當作每次都是全新的遊戲
- 在完成三層地牢時，要有勝利畫面，死亡時要有失敗畫面
- 畫面上要有 retry 按鈕
- 遊戲是單人遊戲


## 專案結構

```
src/
├── components/          # React 組件
│   ├── Game.tsx        # 主要遊戲組件
│   └── index.ts        # 組件匯出
├── hooks/              # 自定義 React Hooks
│   ├── useGameState.ts # 遊戲狀態管理 Hook
│   └── index.ts        # Hooks 匯出
├── systems/            # 遊戲系統
│   ├── RhythmSystem.ts # 節拍系統
│   └── index.ts        # 系統匯出
├── pages/              # 頁面組件
│   ├── HomePage.tsx    # 主頁面
│   └── index.ts        # 頁面匯出
├── assets/             # 靜態資源
├── main.tsx           # 應用程式入口點
└── style.css          # 全域樣式
```

## 技術棧

- **React 18** - 前端框架
- **TypeScript** - 型別安全
- **Vite** - 建置工具
- **ESLint** - 程式碼檢查
- **Prettier** - 程式碼格式化

## 開發指令

```bash
# 安裝依賴項目
npm install

# 啟動開發伺服器
npm run dev

# 建置專案
npm run build

# 預覽建置結果
npm run preview

# 程式碼檢查
npm run lint

# 自動修復 ESLint 錯誤
npm run lint:fix

# 格式化程式碼
npm run format

# 檢查程式碼格式
npm run format:check
```

## 版本規劃

詳細的版本交付清單請參考 [docs/release-plan.md](./docs/release-plan.md)

### 核心特色
- 🎵 **節拍系統**: 120 BPM, 4/4 拍，正負拍音效
- ⚔️ **戰鬥系統**: 反拍攻擊，四種敵人 AI
- 🗺️ **地牢系統**: 三層隨機生成地牢
- 🎁 **獎勵機制**: 房間獎勵 + 層級獎勵
- 🎨 **2.5D 像素風**: 現代像素藝術風格

## 開發計劃

### Phase 1 (v1.0)
- [X] 專案架構建立
- [X] 基本節拍系統 (120 BPM, 4/4 拍)
- [ ] 玩家移動和攻擊系統
- [ ] 四種敵人 AI 實現
- [X] 基本地圖系統 (8×8, 6×6, 4×6)
- [ ] 三層地牢結構
- [ ] 獎勵機制
- [ ] 勝利/失敗畫面

### Phase 2 (未來擴展)
- [ ] 多職業系統
- [ ] 更多敵人類型
- [ ] Boss 戰
- [ ] 技能系統 (衝刺等)
- [ ] 更複雜的地圖生成
- [ ] 音效和背景音樂優化

## 授權

MIT License
