# Rhythm Roguelike Spec

1. Rhythm System
- 節奏會隨著音樂改變，每首個有他的速度。
- 音效系統中，在正負拍應該要有不同的基礎音效（向節拍器那樣），並且負拍的聲音會比較小
- 在畫面中有節奏的 bar
- 判定：與一個節奏遊戲一樣，只有在拍點的前後一個很短的時間按下按鍵時，這個輸入才算是 valid。
- 音樂來源可以先在網路上找固定音軌

2. Player System
- 基礎移動只有上下左右 arrow，不支援斜向，但之後會構思 shift 衝刺等技能，在 v1.0 只要把基礎移動做出來就好
- 在 v1.0 ，玩家會有血量 / 攻擊力兩種屬性，對於戰士而言，基礎預設為 10 滴，傷害 3
- 對於一個戰士，玩家可以在反拍按下 F 攻擊在自己上下左右的其中一個敵人，並且用上下左右 arrow 指定攻擊方向，如果上下左右的敵人只有一個，則沒有指定方向或沒有按到正確的方向也會自動攻擊到該敵人
- 未來要可以支援多個職業，也就是在反拍時按下 F 會有不同的攻擊方式，在 v1.0 只需要有戰士

3. Enemy Design
- 在 v1.0 要設計四種敵人，他們分別是 ：
近戰 A：
血量： 9
攻擊力：2
不相鄰：正拍向玩家靠近一格。
相鄰：若下個正拍時玩家仍在原格 → 攻擊。
若玩家閃走 → 本次攻擊冷卻，不行動。

近戰 B：
血量： 7
攻擊力：3
不相鄰：正拍向玩家靠近一格。
相鄰：若下個正拍時玩家仍在原格 → 攻擊。
若玩家閃走 → 正常移動追擊玩家。

遠程 A：
血量： 5
攻擊力： 3
正拍的模式是三輪循環，兩次移動一次射箭，移動會傾向往遠離角色的同 row 或同 column 方向前進，射箭會面向角色。箭會朝同個方向每隔一個半拍移動一格，碰到角色的格子及損血，撞到牆壁及消失。

史萊姆 A：
血量 5 
攻擊力 2
每兩個正拍會隨機移動一格，在地上留下黏液，當玩家碰到時，下個正拍不能移動

- 製作敵人前，請先定義「向玩家靠近一格」的移動方式
- 在角色位置的判斷中，先是處理角色的判斷，再進行攻擊和移動判斷。例如玩家原本在下個正拍要被箭射中，但他在該正拍移動到其他格子（與箭不同的三個方向），則可以成功閃避那隻箭。
- 在 v1.0 不用有 boss

4. Map Design
- 每個房間會切成很多個格子，玩家和敵人各佔了一個格子，他們都會依照節奏執行不同的行為
- 房間的形狀與大小依照關卡而定，不一定會是一個矩形，但 v1.0 可以先做 8*8 / 6*6 / 4*6 的矩形就好
- 一層地牢會有多個房間，而這個遊戲會擴展到很多層，玩家完成一層與一個房間時都會有獎勵
- 對於 v1.0，請先設計三層，第一層會是 intro，只需要有一個怪物房，與一個有向下樓梯，並且可以開獎勵的房間
- 遊戲希望有 roughlike 屬性：房間數量，房間樣子，各個房間的怪物的種類與數量應該都是具有隨機性的，並且越到下面的關卡應該越難

5. Reward Machenism
每個房間的 reward 目前都設定為生成一個愛心，玩家碰到可以回 3 滴血。
每層的 reward 先設定為生命上限 + 5 / 傷害 + 1 / 回滿血 3 選 1

6. Art Design
- 2.5D 像素風

7. Progression & Meta
- 因為這次作業沒有要寫資料庫，所以每次 run 沒有任何資源保留，可以當作每次都是全新的遊戲
- 在完成三層地牢時，要有勝利畫面，死亡時要有失敗畫面
- 畫面上要有 retry 按鈕
- 遊戲是單人遊戲

## 🎯 v1.0 版本路線圖

```
v0.1 ──► v0.2 ──► v0.3 ──► v0.4 ──► v0.5 ──► v0.6 ──► v0.7 ──► v1.0
 │        │        │        │        │        │        │        │
節拍     玩家     敵人    地圖     戰鬥     獎勵     UI     最終
系統     系統     AI     系統     系統     系統    優化    版本
```

## 📊 版本功能對照表

| 版本 | 核心功能 | 預估時間 | 狀態 |
|------|----------|----------|------|
| **v0.1** | 🎵 節拍系統 (多 BPM 支援, 音效, 判定) | 2-3 天 | ✅ **已完成** |
| **v0.2** | ⚔️ 玩家系統 (移動, 攻擊, 屬性) | 2-3 天 | ⏳ 待開始 |
| **v0.3** | 👹 敵人 AI (四種敵人, 行為邏輯) | 3-4 天 | ⏳ 待開始 |
| **v0.4** | 🗺️ 地圖系統 (房間生成, 三層地牢) | 2-3 天 | ⏳ 待開始 |
| **v0.5** | ⚔️ 戰鬥系統 (碰撞檢測, 戰鬥邏輯) | 2-3 天 | ⏳ 待開始 |
| **v0.6** | 🎁 獎勵系統 (房間獎勵, 層級獎勵) | 1-2 天 | ⏳ 待開始 |
| **v0.7** | 🎨 UI/UX 優化 (視覺效果, 性能) | 2-3 天 | 🔄 **進行中** |
| **v1.0** | 🚀 最終版本 (整合測試, 發布) | 1-2 天 | ⏳ 待開始 |

## 🎮 功能依賴關係

```
節拍系統 (v0.1)
    ↓
玩家系統 (v0.2) ──► 戰鬥系統 (v0.5)
    ↓                    ↓
敵人 AI (v0.3) ──► 獎勵系統 (v0.6)
    ↓                    ↓
地圖系統 (v0.4) ──► UI優化 (v0.7) ──► 最終版本 (v1.0)
```

## 📋 每個版本的交付物

### v0.1 - 節拍系統 ✅ **已完成**
- ✅ 多 BPM 支援 (85-140 BPM, 動態調整)
- ✅ 音樂管理系統 (8首歌曲, 自動循環)
- ✅ 節拍條 UI (RhythmBar 與 RhythmBarManager)
- ✅ 中央圓圈節拍指示器
- ✅ 按鈕音效系統 (hover/click)
- ✅ 歌曲選擇器 (支援難度/類型分類)
- ✅ 統一的歌曲配置管理

### v0.2 - 玩家系統
- ✅ 玩家移動 (上下左右)
- ✅ 玩家攻擊 (反拍 F 鍵)
- ✅ 玩家屬性 (血量 10, 攻擊力 3)
- ✅ 輸入處理系統

### v0.3 - 敵人 AI
- ✅ 近戰 A (血量 9, 攻擊力 2)
- ✅ 近戰 B (血量 7, 攻擊力 3)
- ✅ 遠程 A (血量 5, 攻擊力 3)
- ✅ 史萊姆 A (血量 5, 攻擊力 2)

### v0.4 - 地圖系統
- ✅ 房間生成 (8×8, 6×6, 4×6)
- ✅ 三層地牢結構
- ✅ 房間轉換系統
- ✅ 2.5D 像素風渲染

### v0.5 - 戰鬥系統
- ✅ 碰撞檢測
- ✅ 戰鬥邏輯
- ✅ 遊戲狀態管理
- ✅ 戰鬥 UI

### v0.6 - 獎勵系統
- ✅ 房間獎勵 (愛心 +3 血量)
- ✅ 層級獎勵 (三選一)
- ✅ 獎勵 UI

### v0.7 - UI/UX 優化 🔄 **進行中**
- ✅ 發光按鈕設計 (Hollow Knight 風格)
- ✅ 固定式音樂資訊顯示 (頂部居中)
- ✅ 歌曲選擇按鈕 (右上角固定)
- ✅ 模組化組件架構優化
- ✅ 音樂播放穩定性改善
- ✅ 響應式佈局設計
- ⏳ 遊戲場景視覺效果
- ⏳ 動畫效果優化
- ⏳ 整體性能優化

### v1.0 - 最終版本
- ⏳ 完整功能整合
- ⏳ 勝利/失敗畫面
- ⏳ 最終測試
- ⏳ 文檔完善

---

## 📈 當前開發進度總結

### 🎯 已完成功能
- **完整音樂系統**：支援 8 首不同 BPM 歌曲 (85-140 BPM)
- **動態節拍調整**：節拍條會根據歌曲 BPM 自動調整頻率
- **音樂管理架構**：統一的歌曲配置管理和類型分類系統
- **現代化 UI**：Hollow Knight 風格發光按鈕設計
- **固定式佈局**：音樂資訊固定頂部，歌曲選擇固定右上角
- **音效整合**：按鈕 hover/click 音效，增強互動體驗
- **模組化架構**：關注點分離，提升程式碼可維護性

### 🔧 技術亮點
- **TypeScript 類型安全**：完整的類型定義和介面設計
- **React Hooks 優化**：自定義 hook 管理複雜狀態
- **音頻管理**：穩定的音樂播放，避免重複播放問題
- **響應式設計**：適配不同螢幕尺寸的佈局
- **效能優化**：避免不必要的重新渲染和記憶體洩漏

### 🎵 音樂庫
| 歌曲 | BPM | 難度 | 類型 |
|------|-----|------|------|
| Beating | 120 | Medium | Electronic |
| Blue | 110 | Easy | Ambient |
| Can We Do It | 128 | Hard | Hip Hop |
| EDM | 130 | Hard | Electronic |
| Embrace | 95 | Easy | Ambient |
| Jungle Waves | 115 | Medium | World |
| Sandbreaker | 140 | Hard | Rock |
| Soft Music | 85 | Easy | Chill |

### 🚀 下一步開發重點
1. **v0.2 玩家系統**：實作角色移動和攻擊機制
2. **節拍判定系統**：完善輸入時機判定邏輯
3. **遊戲場景整合**：將音樂系統與遊戲邏輯結合
4. **視覺效果增強**：添加更多動畫和粒子效果

*最後更新：2025年9月29日*
