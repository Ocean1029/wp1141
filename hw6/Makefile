.PHONY: help install dev build start lint clean db-generate db-push db-migrate db-studio db-reset format check-env

# Default target
help:
	@echo ""
	@echo "ğŸ¤– HW6 LINE Bot - Development Commands"
	@echo "========================================"
	@echo ""
	@echo "ğŸ“¦ Installation:"
	@echo "  make install         - Install all dependencies"
	@echo ""
	@echo "ğŸš€ Development:"
	@echo "  make dev             - Start development server"
	@echo "  make build           - Build for production"
	@echo "  make start           - Start production server"
	@echo "  make lint            - Run ESLint"
	@echo ""
	@echo "ğŸ—„ï¸  Database:"
	@echo "  make db-generate     - Generate Prisma Client"
	@echo "  make db-push         - Push schema to database (dev)"
	@echo "  make db-migrate      - Create and run migration"
	@echo "  make db-studio       - Open Prisma Studio"
	@echo "  make db-reset        - Reset database (WARNING: deletes all data)"
	@echo ""
	@echo "ğŸ§¹ Cleanup:"
	@echo "  make clean           - Clean build artifacts and node_modules"
	@echo ""
	@echo "ğŸ“š Documentation:"
	@echo "  make docs            - Open API documentation (http://localhost:3000/api-docs)"
	@echo ""
	@echo "ğŸ” Utilities:"
	@echo "  make check-env       - Check environment variables"
	@echo ""

# Installation
install:
	@echo "ğŸ“¦ Installing dependencies..."
	npm install

# Development
dev:
	@echo "ğŸš€ Starting development server..."
	@echo "ğŸ“š API Docs: http://localhost:3000/api-docs"
	@echo "ğŸ”— Webhook: http://localhost:3000/api/webhook"
	npm run dev

build:
	@echo "ğŸ”¨ Building for production..."
	npm run build

start:
	@echo "â–¶ï¸  Starting production server..."
	npm run start

lint:
	@echo "ğŸ” Running linter..."
	npm run lint

# Database commands
db-generate:
	@echo "ğŸ”§ Generating Prisma Client..."
	npm run db:generate

db-push:
	@echo "ğŸ“¤ Pushing schema to database..."
	npm run db:push

db-migrate:
	@echo "ğŸ”„ Creating and running migration..."
	npm run db:migrate

db-studio:
	@echo "ğŸ¨ Opening Prisma Studio..."
	npm run db:studio

db-reset:
	@echo "This will delete all data in the database!"
	@echo "ğŸ—‘ï¸  Resetting database..."
	npx prisma migrate reset --force
	npm run db:generate
	@echo "Database reset complete!"

# Cleanup
clean:
	@echo "ğŸ§¹ Cleaning up..."
	rm -rf .next
	rm -rf node_modules
	rm -rf .turbo
	rm -f package-lock.json
	rm -f tsconfig.tsbuildinfo
	@echo "âœ… Cleanup complete!"

clean-build:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf .next
	rm -f tsconfig.tsbuildinfo
	@echo "âœ… Build artifacts cleaned!"

# Documentation
docs:
	@echo "ğŸ“š Opening API documentation..."
	@echo "Visit: http://localhost:3000/api-docs"
	@echo "Swagger JSON: http://localhost:3000/api/docs"

# Environment check
check-env:
	@echo "ğŸ” Checking environment variables..."
	@if [ ! -f .env ]; then \
		echo "âŒ .env file not found!"; \
		echo "ğŸ“ Copy .env.example to .env and fill in the values"; \
		exit 1; \
	fi
	@echo "âœ… .env file exists"

# Setup (first time setup)
setup: check-env install db-generate
	@echo ""
	@echo "âœ… Setup complete!"
	@echo ""
	@echo "Next steps:"
	@echo "  1. Make sure your .env file is configured"
	@echo "  2. Run 'make db-push' to sync database schema"
	@echo "  3. Run 'make dev' to start development server"

